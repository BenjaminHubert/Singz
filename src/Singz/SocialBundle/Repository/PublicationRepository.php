<?php

namespace Singz\SocialBundle\Repository;

/**
 * PublicationRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PublicationRepository extends \Doctrine\ORM\EntityRepository
{
    public function getNewsFeed($user) {

        return $this->createQueryBuilder('p')
            ->innerJoin('p.user', 'u')->addSelect('u')
            ->leftJoin('u.followers', 'f')->addSelect('f')
            ->leftJoin('p.loves', 'l')->addSelect('l')
            ->where('f.follower = :follower AND f.isPending = :pending')
            ->setParameter('follower', $user)
            ->setParameter('pending', false)
            ->orderBy('p.date', 'DESC')
            ->getQuery()
            ->getResult();
    }

}
